# ArchThemeM0d Documentation 🎨

*ArchThemeM0d* is a dynamic theming engine for Arch Linux with Hyprland that automatically generates stunning, cohesive application themes directly from your current wallpaper.

## Table of Contents

- [Overview](#overview)
- [Features](#features)
- [Requirements](#requirements)
- [Installation](#installation)
- [Quick Start](#quick-start)
- [Commands](#commands)
- [Template System](#template-system)
- [Color System](#color-system)
- [Configuration](#configuration)
- [Troubleshooting](#troubleshooting)
- [Contributing](#contributing)
- [API Reference](#api-reference)

## Overview

ArchThemeM0d transforms your desktop experience by creating a unified color scheme across all your applications based on your wallpaper.

### How It Works

The system operates in two phases:

1. **Color Extraction**: Analyzes your wallpaper to extract a 16-color palette
2. **Theme Generation**: Classifies colors into design roles and generates complete tonal systems

## Features

- 🎨 **Wallpaper-Based Generation**: Automatically creates rich color palettes from your current wallpaper
- 🧠 **Intelligent Color Classification**: Assigns colors to Primary, Secondary, Tertiary, and Neutral roles
- 🌈 **Material You-Inspired Palettes**: Generates 13-tone ramps for each color role
- 📐 **Template-Driven Architecture**: Easily extend support to any text-based configuration
- 🔄 **Multi-Monitor Support**: Handles different wallpapers per monitor
- ⚡ **High Performance**: Written in Go for speed and efficiency
- 🎯 **Cohesive Experience**: Ensures all applications share harmonious colors

## Requirements

### System Requirements
- **OS**: Arch Linux
- **WM**: Hyprland
- **Wallpaper Manager**: hyprpaper
- **Go**: Version 1.24.5 or higher

### Dependencies
- `hyprctl` (part of Hyprland)
- `hyprpaper` for wallpaper management

## Installation

### From Source

```bash
# Clone the repository
git clone https://github.com/oarabilekoore/archThemeM0d
cd archThemeM0d

# Build the binary
go build -o archThemeM0d main.go

# Install to your PATH (optional)
sudo mv archThemeM0d /usr/local/bin/
```

### Directory Structure

After installation, create the following directory structure in your home directory:

```
~/Templates/ThemeM0d/
├── Templates/          # Your .tmpl files go here
├── Themes/            # Generated themes (auto-created)
└── currenttheme.tm0d  # Generated palette data (auto-created)
```

## Quick Start

### Basic Usage

1. **Generate color palette from wallpaper**:
   ```bash
   archThemeM0d generate
   ```

2. **Build themes from templates**:
   ```bash
   archThemeM0d build
   ```

### First Time Setup

1. Create the template directory:
   ```bash
   mkdir -p ~/Templates/ThemeM0d/Templates
   ```

2. Add your first template (example for Waybar):
   ```bash
   cat > ~/Templates/ThemeM0d/Templates/waybar.css.tmpl << 'EOF'
   /* Waybar Theme - Generated by ArchThemeM0d */

   * {
       border: none;
       border-radius: 0;
       font-family: "JetBrains Mono Nerd Font";
       font-size: 13px;
       min-height: 0;
   }

   window#waybar {
       background-color: {{.Theme.Surface | toHex}};
       color: {{.Theme.OnSurface | toHex}};
       transition-property: background-color;
       transition-duration: .5s;
   }

   button {
       background-color: {{.Theme.Primary | tone 20 | toHex}};
       color: {{.Theme.Primary | tone 80 | toHex}};
       border-radius: 5px;
       margin: 2px;
   }

   button:hover {
       background-color: {{.Theme.Primary | tone 30 | toHex}};
   }
   EOF
   ```

3. Generate and build:
   ```bash
   archThemeM0d generate
   archThemeM0d build
   ```

4. Your themed files will be in `~/Templates/ThemeM0d/Themes/[monitor-name]/`

## Commands

### `generate`

Extracts color palette from your current wallpaper(s).

```bash
archThemeM0d generate
```

**What it does:**
- Queries hyprpaper for active wallpapers
- Extracts 12 dominant colors per wallpaper
- Saves palette data to `currenttheme.tm0d`
- Handles multi-monitor setups automatically

**Output:** JSON file containing monitor-specific color palettes

### `build`

Processes templates using the generated color palette.

```bash
archThemeM0d build
```

**What it does:**
- Reads palette data from `currenttheme.tm0d`
- Classifies colors into design roles
- Generates complete tonal palettes
- Processes all `.tmpl` files in Templates directory
- Outputs themed configuration files

**Output:** Themed configuration files in `Themes/[monitor-name]/`

## Template System

### Template Basics

Templates use Go's `text/template` syntax with custom functions for color manipulation.

### Available Data Structure

```go
type TemplateData struct {
    Monitor string           // Monitor name (e.g., "DP-1")
    Theme   ClassifiedTheme  // Complete color system
}

type ClassifiedTheme struct {
    Primary   TonalPalette  // Primary color system
    Secondary TonalPalette  // Secondary color system
    Tertiary  TonalPalette  // Tertiary color system
    Neutral   TonalPalette  // Neutral color system

    // Pre-defined surface colors
    Surface          color.RGBA  // App backgrounds
    SurfaceVariant   color.RGBA  // Cards, dialogs
    OnSurface        color.RGBA  // Text on Surface
    OnSurfaceVariant color.RGBA  // Secondary text
    PrimaryFixed     color.RGBA  // Consistent primary
    OnPrimaryFixed   color.RGBA  // Text on PrimaryFixed
}
```

### Template Functions

#### `toHex`
Converts a color to hexadecimal format.

```go
{{.Theme.Primary | tone 80 | toHex}}
// Output: #ff5722
```

#### `toRgba`
Converts a color to RGBA format with alpha.

```go
{{.Theme.Primary | tone 80 | toRgba "0.8"}}
// Output: rgba(255, 87, 34, 0.8)
```

#### `tone`
Extracts a specific tone level from a tonal palette.

```go
{{.Theme.Primary | tone 50}}        // Mid-tone
{{.Theme.Secondary | tone 90}}      // Very light
{{.Theme.Neutral | tone 10}}        // Very dark
```

### Template Examples

#### Rofi Theme
```css
/* ~/Templates/ThemeM0d/Templates/rofi-theme.rasi.tmpl */

* {
    background-color: {{.Theme.Surface | toHex}};
    foreground-color: {{.Theme.OnSurface | toHex}};
    accent-color: {{.Theme.Primary | tone 60 | toHex}};
}

window {
    background-color: {{.Theme.Surface | toRgba "0.95"}};
    border: 2px solid {{.Theme.Primary | tone 40 | toHex}};
    border-radius: 8px;
}

inputbar {
    background-color: {{.Theme.SurfaceVariant | toHex}};
    text-color: {{.Theme.OnSurfaceVariant | toHex}};
}

selected {
    background-color: {{.Theme.Primary | tone 30 | toHex}};
    text-color: {{.Theme.Primary | tone 90 | toHex}};
}
```

#### Kitty Terminal
```ini
# ~/Templates/ThemeM0d/Templates/kitty.conf.tmpl

# Colors
background {{.Theme.Surface | toHex}}
foreground {{.Theme.OnSurface | toHex}}

# Selection
selection_background {{.Theme.Primary | tone 40 | toHex}}
selection_foreground {{.Theme.Primary | tone 90 | toHex}}

# Cursor
cursor {{.Theme.Primary | tone 70 | toHex}}
cursor_text_color {{.Theme.Surface | toHex}}

# Normal colors
color0  {{.Theme.Neutral | tone 10 | toHex}}
color1  {{.Theme.Primary | tone 60 | toHex}}
color2  {{.Theme.Secondary | tone 60 | toHex}}
color3  {{.Theme.Tertiary | tone 60 | toHex}}
color4  {{.Theme.Primary | tone 50 | toHex}}
color5  {{.Theme.Secondary | tone 50 | toHex}}
color6  {{.Theme.Tertiary | tone 50 | toHex}}
color7  {{.Theme.Neutral | tone 80 | toHex}}

# Bright colors
color8  {{.Theme.Neutral | tone 40 | toHex}}
color9  {{.Theme.Primary | tone 80 | toHex}}
color10 {{.Theme.Secondary | tone 80 | toHex}}
color11 {{.Theme.Tertiary | tone 80 | toHex}}
color12 {{.Theme.Primary | tone 70 | toHex}}
color13 {{.Theme.Secondary | tone 70 | toHex}}
color14 {{.Theme.Tertiary | tone 70 | toHex}}
color15 {{.Theme.Neutral | tone 90 | toHex}}
```

#### Dunst Notification
```ini
# ~/Templates/ThemeM0d/Templates/dunstrc.tmpl

[global]
background = "{{.Theme.SurfaceVariant | toHex}}"
foreground = "{{.Theme.OnSurfaceVariant | toHex}}"
frame_color = "{{.Theme.Primary | tone 40 | toHex}}"

[urgency_low]
background = "{{.Theme.Surface | toHex}}"
foreground = "{{.Theme.OnSurface | toHex}}"
frame_color = "{{.Theme.Neutral | tone 50 | toHex}}"

[urgency_normal]
background = "{{.Theme.SurfaceVariant | toHex}}"
foreground = "{{.Theme.OnSurfaceVariant | toHex}}"
frame_color = "{{.Theme.Primary | tone 60 | toHex}}"

[urgency_critical]
background = "{{.Theme.Primary | tone 30 | toHex}}"
foreground = "{{.Theme.Primary | tone 90 | toHex}}"
frame_color = "{{.Theme.Primary | tone 70 | toHex}}"
```

## Color System

### Design Principles

ArchThemeM0d follows Material You design principles with adaptations for desktop environments:

- **Primary**: Most prominent brand/accent color
- **Secondary**: Supporting color for variety
- **Tertiary**: Additional accent for balance
- **Neutral**: Background and surface colors

### Tone Levels

Each color role includes 13 tone levels:

| Tone | Usage | Description |
||-|-|
| 0    | Black | Pure black |
| 10   | Very Dark | Dark surfaces, text on light |
| 20   | Dark | Dark elements |
| 30   | Medium Dark | Hover states |
| 40   | Medium Dark | Borders, dividers |
| 50   | Medium | Disabled text |
| 60   | Medium Light | Secondary text |
| 70   | Light | Primary text on dark |
| 80   | Light | Seed color placement |
| 90   | Very Light | Text on dark surfaces |
| 95   | Near White | Light surface variants |
| 99   | Nearly White | Background highlights |
| 100  | White | Pure white |

### Color Classification Algorithm

1. **Saturation Analysis**: Colors sorted by vibrancy
2. **Role Assignment**:
   - Highest saturation → Primary
   - Second highest → Secondary
   - Third highest → Tertiary
   - Lowest unused → Neutral
3. **Tonal Generation**: 13-step ramps created for each role

## Configuration

### Multi-Monitor Setup

ArchThemeM0d automatically handles multiple monitors:

```json
[
  {
    "monitor": "DP-1",
    "theme": {
      "wallpaper_location": "/path/to/wallpaper1.jpg",
      "palletes": [...colors...]
    }
  },
  {
    "monitor": "HDMI-A-1",
    "theme": {
      "wallpaper_location": "/path/to/wallpaper2.jpg",
      "palletes": [...colors...]
    }
  }
]
```

Templates are processed per monitor, creating separate theme files for each.

### Hyprland Integration

Add to your Hyprland config for automatic theme updates:

```bash
# ~/.config/hypr/hyprland.conf

# Bind theme regeneration to a key
bind = $mainMod SHIFT, T, exec, archThemeM0d generate && archThemeM0d build && ~/.config/scripts/reload-apps.sh

# Auto-reload on wallpaper change (requires script)
exec-once = ~/.config/scripts/wallpaper-monitor.sh
```

### Reload Script Example

```bash
#!/bin/bash
# ~/.config/scripts/reload-apps.sh

# Reload applications after theme update
pkill -USR2 waybar  # Reload Waybar
pkill -USR1 dunst   # Reload Dunst notifications

# Copy themes to application directories
cp ~/Templates/ThemeM0d/Themes/*/waybar.css ~/.config/waybar/
cp ~/Templates/ThemeM0d/Themes/*/kitty.conf ~/.config/kitty/
cp ~/Templates/ThemeM0d/Themes/*/rofi-theme.rasi ~/.config/rofi/

echo "Themes reloaded!"
```

## Troubleshooting

### Common Issues

#### "This only works with arch hyprland"
**Cause**: Not running in Hyprland environment
**Fix**: Ensure `HYPRLAND_INSTANCE_SIGNATURE` environment variable is set

#### "No Wallpapers Found"
**Cause**: hyprpaper not running or no wallpapers set
**Fix**:
```bash
# Check hyprpaper status
hyprctl hyprpaper listactive

# Set a wallpaper
hyprpaper preload ~/wallpapers/image.jpg
hyprpaper wallpaper "DP-1,~/wallpapers/image.jpg"
```

#### "Template parsing failed"
**Cause**: Syntax error in template
**Fix**: Check template syntax, ensure proper `{{}}` delimiters

#### "Failed to get palette"
**Cause**: Corrupted or unsupported image format
**Fix**: Use JPG or PNG images, check file permissions

### Debug Mode

Add debug output by modifying template functions:

```go
{{printf "Primary 80: %s" (.Theme.Primary | tone 80 | toHex)}}
```

### File Permissions

Ensure proper permissions:
```bash
chmod 755 ~/Templates/ThemeM0d/
chmod 644 ~/Templates/ThemeM0d/Templates/*.tmpl
```

## Contributing

### Development Setup

```bash
# Clone and setup
git clone <repo-url>
cd ArchThemeM0d
go mod tidy

# Run tests
go test ./...

# Build
go build -o archThemeM0d main.go
```

### Adding New Template Functions

1. Add function to `funcMap` in `templatefill.go`:

```go
funcMap := template.FuncMap{
    "toHex": func(c color.RGBA) string {
        return fmt.Sprintf("#%02x%02x%02x", c.R, c.G, c.B)
    },
    "newFunction": func(args...) returnType {
        // Implementation
    },
}
```

### Code Structure

```
ArchThemeM0d/
├── main.go              # Entry point
├── cmd/
│   ├── root.go         # CLI root command
│   ├── generate.go     # Wallpaper analysis & extraction
│   └── templatefill.go # Theme classification & building
├── go.mod              # Dependencies
└── go.sum              # Dependency checksums
```

## API Reference

### Types

#### `WallpaperInfo`
```go
type WallpaperInfo struct {
    WallpaperPath string       `json:"wallpaper_location"`
    Palletes      []color.RGBA `json:"palletes"`
}
```

#### `MonitorInfo`
```go
type MonitorInfo struct {
    Monitor string        `json:"monitor"`
    Theme   WallpaperInfo `json:"theme"`
}
```

#### `TonalPalette`
```go
type TonalPalette struct {
    Tones map[int]color.RGBA  // Tone level (0-100) to color
}
```

#### `ClassifiedTheme`
```go
type ClassifiedTheme struct {
    Primary   TonalPalette
    Secondary TonalPalette
    Tertiary  TonalPalette
    Neutral   TonalPalette

    Surface          color.RGBA
    SurfaceVariant   color.RGBA
    OnSurface        color.RGBA
    OnSurfaceVariant color.RGBA
    PrimaryFixed     color.RGBA
    OnPrimaryFixed   color.RGBA
}
```

### Functions

#### `getDominantColors(imagePath string) ([]color.Color, error)`
Extracts 12 dominant colors from an image file.

#### `classifyPalette(palette []color.RGBA) ClassifiedTheme`
Analyzes colors and generates complete Material You theme structure.

#### `generateTonalPalette(seed color.RGBA) TonalPalette`
Creates 13-tone ramp from a single seed color.

#### `rgbToHsl(c color.RGBA) (h, s, l float64)`
Converts RGB color to HSL for analysis.

## License

This project is under the MIT License.

## Acknowledgments

- Material You Design System by Google (Inspiration)
- colorthief-go for color extraction
- Cobra CLI framework
- The Hyprland community (I use arch btw)


** Made with ❤️ by Oarabile Koore**
